---
title: Financial Ratios
metadata:
  pagetitle: Financial Ratios with R
  description-meta: Learn how to use the programming language R to analyze companies using financial ratios.
cache: true
---

In this chapter, we explore the role of financial statements and financial ratios in analyzing companies. Financial statements are essential because they serve as a standardized source of information, providing a consistent framework that enables investors, creditors, and analysts to assess a company’s financial health and performance. All companies are legally required to file financial statements, which adds a layer of accountability and reliability to the information they disclose. Public companies, in particular, are subject to even more rigorous standards: they must have their financial statements independently audited, which helps ensure accuracy and integrity in reporting. Additionally, in the United States, public companies are required by the Securities and Exchange Commission, or SEC, to file their financials quarterly and annually. This requirement ensures that investors and analysts have timely information, allowing them to make informed decisions throughout the year.

Financial ratios are tools for understanding a company’s financial health and performance. They facilitate:

- Benchmarking: By comparing ratios across different companies, investors and analysts can assess how a company stands relative to its peers within the same industry.
-	Trend Analysis: Evaluating a company’s financial ratios over multiple periods reveals trends and patterns, offering insights into its financial trajectory and operational effectiveness.
-	Portfolio Selection: Investors often use financial ratios to screen and select high-quality firms for their portfolios. 
-	Asset Pricing Models: Financial ratios are integral to factor models in asset pricing, such as the Fama-French three-factor model or Q-factors)
-	Capital Structure and Risk Management: Ratios aid in assessing its risk profile and predicting potential financial distress. 

This chapter is based on the following packages: 

```{r}
#| message: false
#| warning: false
library(tidyverse)
library(tidyfinance)
library(scales)
library(ggrepel)
library(fmpapi)
```

## Balance Sheet Statements

The balance sheet provides a snapshot of a company's financial standing at a specific point in time. It shows the company’s assets, liabilities, and shareholders’ equity, according to the fundamental accounting equation: 

$$\text{Assets} = \text{Liabilities} + \text{Shareholders’ Equity}$$

Assets are the resources owned by the company that are expected to provide future economic benefits, liabilities are obligations the company owes to external parties, and shareholders’ equity is the residual interest in the assets of the company after deducting liabilities. @fig-400 shows a stylized balance sheet with these components.

![A stylized representation of a balance sheet statement.](../assets/img/balance-sheet.svg){#fig-400 alt="A stylized representation of a balance sheet statement."}

Let us dive deeper into the asset side which typically comprises of the following parts: current assets that are expected to be converted into cash or used up within one year, such as cash, accounts receivable (=money owed to a business for goods or services), and inventory, non-current assets, which are long-term investments and property, plant, and equipment (PP&E) that are not expected to be liquidated within a year, and intangible assets, which are non-physical asset such as a patent, brand, trademark, or copyright. @fig-401 shows a stylized breakdown of the asset side. 
 
![A stylized representation of a breakdown of assets on a balance sheet.](../assets/img/assets.svg){#fig-401 alt="A stylized representation of a breakdown of assets on a balance sheet."}

Liabilities are typically split into current liabilities, which are debts or obligations due within one year, including accounts payable and short-term loans, and non-current liabilities, which are long-term debts and obligations due beyond one year, such as long-term debt or deferred taxes. @fig-402 illustrates this breakdown in liabilities. 

![A stylized representation of a breakdown of liabilities on a balance sheet.](../assets/img/liabilities.svg){#fig-402 alt="A stylized representation of a breakdown of liabilities on a balance sheet."}

Lastly, equity is typically divided into retained earnings, which are accumulated profits that have been reinvested in the business rather than distributed as dividends, common stock, which is capital contributed by shareholders, and preferred stock, which is a different type of equity that represents ownership of a company and the right to claim income from the company’s operations, but with limited voting rights. @fig-403 shows the corresponding equity breakdown.

![A stylized representation of a breakdown of equity on a balance sheet.](../assets/img/equity.svg){#fig-403 alt="A stylized representation of a breakdown of equity on a balance sheet."}

@fig-404 shows an example balance sheet from Microsoft in 2023. 

![A screenshot of the balance sheet statement of Microsoft in 2023.](../assets/img/balance-sheet-msft.png){#fig-404 alt="A screenshot of the balance sheet statement of Microsoft in 2023."}

We can use the `fmpapi` package to download financial statements:

- SEC provides interface to [search filings](https://www.sec.gov/search-filings)
- [Financial Modeling Prep (FMP) API](https://site.financialmodelingprep.com/developer/docs) provides programming interface
- Free tier: 250 calls / day, 5 year historical fundamental data
- R package: [tidy-finance/r-fmpapi](https://github.com/tidy-finance/r-fmpapi)
- Install via `install.packages("fmpapi")`

```{r}
#| cache: true 
fmp_get(
  resource = "balance-sheet-statement", 
  symbol = "MSFT", 
  params = list(period = "annual", limit = 5)
)
```

## Income Statements

Income statements show a company’s financial performance over a quarter or year by detailing revenue, costs, and profits. It's main components are:

- Revenue (Sales): the total income generated from goods or services sold.
- Cost of Goods Sold (COGS): direct costs associated with producing the goods or services (raw materials, labor, etc.).
- Gross Profit: revenue minus COGS, showing the basic profitability from core operations.
- Operating Expenses: costs related to regular business operations (Salaries, Rent, Marketing).
- Operating Income (EBIT): earnings before interest and taxes (measures profitability from core operations before financing and tax costs).
- Net Income: The “bottom line”—total profit after all expenses, taxes, and interest are subtracted from revenue.

@fig-405 provides a stylized representation of these components. Income statements are key in analyizing profitability, operational efficiency, and cost management of a company.

![A stylized representation of an income statement.](../assets/img/income-statements.svg){#fig-405 alt="A stylized representation of an income statement."}

@fig-406 shows an example income statements of Microsoft 2023.

![A screenshot of the income statement of Microsoft in 2023.](../assets/img/income-statements-msft.png){#fig-406 alt="A screenshot of the income statement of Microsoft in 2023."}

Download income statements data:

```{r}
#| cache: true 
fmp_get(
  resource = "income-statement", 
  symbol = "MSFT", 
  params = list(period = "annual", limit = 5)
)
```

## Cash Flow Statements

Cash flow statements provide details about the flow of cash in and out of the business during a quarter or year, categorized into operating, investing, and financing activities. Overall, they show a company’s ability to generate cash to fund operations and growth.

- Operating Activities: cash generated from a company’s core business activities (Net Income adjusted for non-cash items like depreciation, and changes in working capital).
- Financing Activities: cash flows related to borrowing, repaying debt, issuing equity, or paying dividends.
- Investing Activities: cash spent on or received from long-term investments, such as purchasing or selling property, equipment, or securities.

@fig-407 shows a stylized cash flow statement. 

![A stylized representation of a cash flow statement.](../assets/img/cash-flow-statements.svg){#fig-407 alt="A stylized representation of a cash flow statement."}

@fig-408 shows example cash flow statements of Microsoft 2023.

![A screenshot of the cash flow statement of Microsoft in 2023.](../assets/img/cash-flow-statements-msft.png){#fig-408 alt="A screenshot of the cash flow statement of Microsoft in 2023."}

Download cash flow statements data for Microsoft:

```{r}
#| cache: true 
fmp_get(
  resource = "cash-flow-statement", 
  symbol = "MSFT", 
  params = list(period = "annual", limit = 5)
)
```

## Download Financial Statements

```{r}
#| cache: true 
constituents <- download_data_constituents("Dow Jones Industrial Average") |> 
  pull(symbol)

params <- list(period = "annual", limit = 5)

balance_sheet_statements <- constituents |> 
  map_df(
    \(x) fmp_get(resource = "balance-sheet-statement", symbol = x, params = params)
  )

income_statements <- constituents |> 
  map_df(
    \(x) fmp_get(resource = "income-statement", symbol = x, params = params)
  )

cash_flow_statements <- constituents |> 
  map_df(
    \(x) fmp_get(resource = "cash-flow-statement", symbol = x, params = params)
  )
```

## Liquidity Ratios

We start with ratios that aim to assess a company's liquidity using items from balance sheet statements. The Current Ratio measures a company's ability to pay off its short-term liabilities with its short-term assets. A ratio above 1 indicates that the company has more current assets than current liabilities, suggesting good short-term financial health. 

$$\text{Current Ratio} = \frac{\text{Current Assets}}{\text{Total Assets}}$$

The next ratio is the Quick Ratio, which measures a company's ability to meet its short-term obligations without relying on the sale of inventory. A ratio above 1 here indicates that the company can cover its short-term liabilities with its most liquid assets. 

$$\text{Quick Ratio} = \frac{\text{Current Assets - Liabilities}}{\text{Current Liabilities}}$$
Lastly, the Cash Ratio measures a company's ability to pay off its short-term liabilities with its cash and cash equivalents. A ratio of 1 or higher indicates a strong liquidity position. 

$$\text{Cash Ratio} = \frac{\text{Cash and Cash Equivalents}}{\text{Current Liabilities}}$$

```{r}
selected_symbols <- c("MSFT", "AAPL", "AMZN")

balance_sheets_statements <- balance_sheet_statements |> 
  mutate(
    current_ratio = total_current_assets / total_assets,
    quick_ratio = (total_current_assets - total_liabilities) / total_current_liabilities,
    cash_ratio = cash_and_cash_equivalents / total_current_liabilities,
    label = if_else(symbol %in% selected_symbols, symbol, NA),
  )
```

Comparing liquidity ratios @fig-409 shows...

```{r}
#| label: fig-409
#| fig-cap: "Liquidity ratios are based on financial statements as provided through the FMP API." 
#| fig-alt: "Title: Liquidity ratios for selected stocks for 2023. The figure shows a bar chart liquidity ratios on the vertical and corresponding values on the horizontal axis."
fig_liquidity_ratios <- balance_sheets_statements |> 
  filter(calendar_year == 2023 & !is.na(label)) |> 
  select(symbol, contains("ratio")) |> 
  pivot_longer(-symbol) |> 
  mutate(name = str_to_title(str_replace_all(name, "_", " "))) |> 
  ggplot(aes(x = value, y = name, fill = symbol)) +
  geom_col(position = "dodge") +
  scale_x_continuous(labels = percent) + 
  labs(
    x = NULL, y = NULL, fill = NULL,
    title = "Liquidity ratios for selected stocks from the Dow index for 2023"
  )
fig_liquidity_ratios
```

## Leverage Ratios

The debt-to-equity ratio measures the proportion of debt financing relative to equity financing. A higher ratio indicates more leverage and potentially higher financial risk. 

$$\text{Debt-to-Equity} = \frac{\text{Total Debt}}{\text{Total Equity}}$$

The debt-to-asset ratio indicates the percentage of a company’s assets that are financed by debt. A higher ratio also suggests more leverage. 

$$\text{Debt-to-Asset} = \frac{\text{Total Debt}}{\text{Total Assets}}$$

Interest Coverage assesses a company’s ability to pay interest on its debt. Here, a higher ratio indicates better capability to meet interest obligations, and hence less financial risk. 

$$\text{Interest Coverage} = \frac{\text{EBIT}}{\text{Interest Expense}}$$

We can easily calculate these ratios using our balance sheet and income statements data:

```{r}
balance_sheets_statements <- balance_sheets_statements |> 
  mutate(
    debt_to_equity = total_debt / total_equity,
    debt_to_asset = total_debt / total_assets
  )

income_statements <- income_statements |> 
  mutate(
    interest_coverage = operating_income / interest_expense,
    label = if_else(symbol %in% selected_symbols, symbol, NA),
  )
```

@fig-410 shows the debt-to-assets over time.

```{r}
#| label: fig-410
#| fig-cap: "Debt-to-asset ratios are based on financial statements as provided through the FMP API." 
#| fig-alt: "Title: Debt-to-asset ratios of selected stocks between 2020 and 2024. The figure shows a line chart with years on the horizontal axis and debt-to-asset ratios on the vertical axis."
fig_debt_to_asset <- balance_sheets_statements |> 
  filter(symbol %in% selected_symbols) |> 
  ggplot(aes(x = calendar_year, y = debt_to_asset,
             color = symbol)) +
  geom_line(linewidth = 1) +
  scale_y_continuous(labels = percent) +
  labs(x = NULL, y = NULL, color = NULL,
       title = "Debt-to-asset ratios of selected stocks between 2020 and 2024") 
fig_debt_to_asset
```

@fig-411 shows debt-to-asset ratio in the cross-section

```{r}
#| label: fig-411
#| fig-cap: "Debt-to-asset ratios are based on financial statements as provided through the FMP API." 
#| fig-alt: "Title: Debt-to-asset ratios of Dow index constituents in 2023. The figure shows a bar chart with debt-to-asset ratios on the horizontal and corresponding symbols on the vertical axis."
selected_colors <- c("#F21A00", "#EBCC2A", "#3B9AB2", "lightgrey")

fig_debt_to_asset_cross_section <-  balance_sheets_statements |> 
  filter(calendar_year == 2023) |> 
  ggplot(aes(x = debt_to_asset,
             y = fct_reorder(symbol, debt_to_asset),
             fill = label)) +
  geom_col() +
  scale_x_continuous(labels = percent) +
  scale_fill_manual(values = selected_colors) +
  labs(x = NULL, y = NULL, color = NULL,
       title = "Debt-to-asset ratios of Dow index constituents in 2023") + 
  theme(legend.position = "none")
fig_debt_to_asset_cross_section
```

@fig-412 shows debt-to-asset vs interest coverage
 
```{r}
#| label: fig-412
#| fig-cap: "Debt-to-asset ratios and interest coverages are based on financial statements as provided through the FMP API." 
#| fig-alt: "Title: Debt-to-asset ratios and interest coverages for Dow index constituents. The figure shows a scatter plot with debt-to-asset on the horizontal and interest coverage on the vertical axis."
fig_debt_to_asset_interest_coverage <- income_statements |> 
  filter(calendar_year == 2023) |> 
  select(symbol, interest_coverage, calendar_year) |> 
  left_join(
    balance_sheets_statements,
    join_by(symbol, calendar_year)
  ) |> 
  ggplot(aes(x = debt_to_asset, y = interest_coverage, color = label)) +
  geom_point(size = 2) +
  geom_label_repel(aes(label = label), seed = 42, box.padding = 0.75) +
  scale_x_continuous(labels = percent) +
  scale_y_continuous(labels = percent) +
  scale_color_manual(values = selected_colors) +
  labs(
    x = "Debt-to-Asset", y = "Interest Coverage",
    title = "Debt-to-asset ratios and interest coverages for Dow index constituents"
  ) +
  theme(legend.position = "none")
fig_debt_to_asset_interest_coverage
```

## Efficiency Ratios

Asset Turnover measures how efficiently a company uses its assets to generate revenue. A higher ratio indicates more efficient use of assets. 

$$\text{Asset Turnover} = \frac{\text{Revenue}}{\text{Total Assets}}$$

Inventory turnover indicates how many times a company’s inventory is sold and replaced over a period. The higher the ratio, the more efficient is the inventory management. 

$$\text{Inventory Turnover} = \frac{\text{COGS}}{\text{Inventory}}$$

Receivables turnover measures how effectively a company collects receivables. A higher ratio indicates a more efficient credit and collection processes. 

$$\text{Receivables Turnover} = \frac{\text{Revenue}}{\text{Accounts Receivable}}$$

```{r}
combined_statements <- balance_sheets_statements |> 
  select(symbol, calendar_year, label, current_ratio, quick_ratio, cash_ratio,
         debt_to_equity, debt_to_asset, total_assets, total_equity) |> 
  left_join(
    income_statements |> 
      select(symbol, calendar_year, interest_coverage, revenue, cost_of_revenue,
             selling_general_and_administrative_expenses, interest_expense,
             gross_profit, net_income),
    join_by(symbol, calendar_year)
  ) |> 
  left_join(
    cash_flow_statements |> 
      select(symbol, calendar_year, inventory, accounts_receivables),
     join_by(symbol, calendar_year)
  )

combined_statements <- combined_statements |> 
  mutate(
    asset_turnover = revenue / total_assets,
    inventory_turnover = cost_of_revenue / inventory,
    receivables_turnover = revenue / accounts_receivables
  )
```

## Profitability Ratios

Gross margin shows the percentage of revenue that exceeds the cost of goods sold (COGS). A higher gross margin implies that the company retains a higher percentage of revenue as gross profit. 

$$\text{Gross Margin} = \frac{\text{Gross Profit}}{\text{Revenue}}$$

Profit margin is the percentage of revenue that translates into net income. A higher profit margin suggests a more profitable company. 

$$\text{Profit Margin} = \frac{\text{Net Income}}{\text{Revenue}}$$

After-tax ROE measures the return on shareholders' equity after accounting for taxes. A higher ROE indicates that the company is effectively generating profit from shareholders' investments. 

$$\text{After-Tax ROE} = \frac{\text{Net Income}}{\text{Total Equity}}$$

```{r}
combined_statements <- combined_statements |> 
  mutate(
    gross_margin = gross_profit / revenue,
    profit_margin = net_income / revenue,
    after_tax_roe = net_income / total_equity
  )
```

Gross margin over time @fig-413 shows

```{r}
#| label: fig-413
#| fig-cap: "Gross margins are based on financial statements as provided through the FMP API." 
#| fig-alt: "Title: Gross margins for selected stocks between 2019 and 2023. The figure shows a line chart with years on the horizontal axis and gross margins on the vertical axis."
fig_gross_margin <- combined_statements |> 
  filter(symbol %in% selected_symbols) |> 
  ggplot(aes(x = calendar_year, y = gross_margin, color = symbol)) +
  geom_line() +
  scale_y_continuous(labels = percent) + 
  labs(x = NULL, y = NULL, color = NULL,
       title = "Gross margins for selected stocks between 2019 and 2023")
fig_gross_margin
```

Profit margin vs gross margin @fig-414 shows

```{r}
#| label: fig-414
#| fig-cap: "Gross and profit margins are based on financial statements as provided through the FMP API." 
#| fig-alt: "Title: Gross and profit margins for Dow index constituents for 2023. The figure shows a scatter plot with gross margins on the horizontal and profit margins on the vertical axis."
fig_gross_margin_profit_margin <- combined_statements |> 
  filter(calendar_year == 2023) |> 
  ggplot(aes(x = gross_margin, y = profit_margin, color = label)) +
  geom_point(size = 2) +
  geom_label_repel(aes(label = label), seed = 42, box.padding = 0.75) +
  scale_x_continuous(labels = percent) +
  scale_y_continuous(labels = percent) + 
  scale_color_manual(values = selected_colors) + 
  labs(
    x = "Gross margin", y = "Profit margin",
    title = "Gross and profit margins for Dow index constituents for 2023"
  )  +
  theme(legend.position = "none")
fig_gross_margin_profit_margin
```

## Combining Financial Ratios

Ranking companies in different categories

@fig-415 shows

```{r}
#| label: fig-415
#| fig-cap: "Ranks are based on financial statements as provided through the FMP API." 
#| fig-alt: "Title: Rank in financial ratio categories for selected stocks from the Dow index. The figure shows a scatter plot with ranks for selected stocks on the horizontal and categories of financial ratios on the vertical axis."
financial_ratios <- combined_statements |> 
  filter(calendar_year == 2023) |> 
  select(symbol, 
         contains(c("ratio", "margin", "roe", "_to_", "turnover", "interest_coverage"))) |> 
  pivot_longer(cols = -symbol) |> 
  mutate(
    type = case_when(
      name %in% c("current_ratio", "quick_ratio", "cash_ratio") ~ "Liquidity Ratios",
      name %in% c("debt_to_equity", "debt_to_asset", "interest_coverage") ~ "Leverage Ratios",
      name %in% c("asset_turnover", "inventory_turnover", "receivables_turnover") ~ "Efficiency Ratios",
      name %in% c("gross_margin", "profit_margin", "after_tax_roe") ~ "Profitability Ratios"
    )
  ) 

fig_ranks <- financial_ratios |> 
  group_by(type, name) |> 
  arrange(desc(value)) |> 
  mutate(rank = row_number()) |> 
  group_by(symbol, type) |> 
  summarize(rank = mean(rank), 
            .groups = "drop") |> 
  filter(symbol %in% selected_symbols) |> 
  ggplot(aes(x = rank, y = type, color = symbol)) +
  geom_point(shape = 17, size = 4) +
  scale_color_manual(values = selected_colors) + 
  labs(x = "Average rank", y = NULL, color = NULL,
       title = "Average rank among Dow index constituents for selected stocks") +
  coord_cartesian(xlim = c(1, 30))
fig_ranks
```

## Financial Ratios in Asset Pricing

The Fama-French five-factor model aims to explain stock returns by incorporating specific financial metrics ratios. We provide more details in [Replicating Fama-French Factors](replicating-fama-and-french-factors.qmd), but here is an intuitive overview:

-  Size: Calculated as the logarithm of a company’s market capitalization, which is the total market value of its outstanding shares. This factor captures the tendency for smaller firms to outperform larger ones over time.
- Book-to-Market Ratio: Determined by dividing the company’s book equity by its market capitalization. A higher ratio indicates a 'value' stock, while a lower ratio suggests a 'growth'’' stock. This metric helps differentiate between undervalued and overvalued companies.
- Profitability: Measured as the ratio of operating profit to book equity, where operating profit is calculated as revenue minus cost of goods sold (COGS), selling, general, and administrative expenses (SG&A), and interest expense. This factor assesses a company’s efficiency in generating profits from its equity base.
- Investment: Calculated as the percentage change in total assets from the previous period. This factor reflects the company’s growth strategy, indicating whether it is investing aggressively or conservatively.

We can calculate these factors using the FMP API as follows:

```{r}
market_cap <- constituents |> 
  map_df(
    \(x) fmp_get(
      resource = "historical-market-capitalization", 
      x, 
      list(from = "2023-12-29", to = "2023-12-29")
    )
  ) 

combined_statements_ff <- combined_statements |> 
  filter(calendar_year == 2023) |> 
  left_join(market_cap, join_by(symbol)) |> 
  left_join(
    balance_sheets_statements |> 
      filter(calendar_year == 2022) |> 
      select(symbol, total_assets_lag = total_assets), 
    join_by(symbol)
  ) |> 
  mutate(
    size = log(market_cap),
    book_to_market = market_cap / total_equity,
    operating_profitability = (revenue - cost_of_revenue - selling_general_and_administrative_expenses - interest_expense) / total_equity,
    investment = total_assets / total_assets_lag
  )
```

@fig-416 shows the ranks of our selected stocks for the Fama-French factors. 

```{r}
#| label: fig-416
#| fig-cap: "Ranks are based on financial statements and historical market capitalization as provided through the FMP API." 
#| fig-alt: "Title: Rank in Fama-French variables for selected stocks from the Dow index. The figure shows a scatter plot with ranks for selected stocks on the horizontal and Fama-French variables on the vertical axis."
fig_rank_ff <- combined_statements_ff |> 
  select(symbol, Size = size, 
         `Book-to-Market` = book_to_market, 
         `Profitability` = operating_profitability,
         Investment = investment) |> 
  pivot_longer(-symbol) |> 
  group_by(name) |> 
  arrange(desc(value)) |> 
  mutate(rank = row_number()) |> 
  ungroup() |> 
  filter(symbol %in% selected_symbols) |> 
  ggplot(aes(x = rank, y = name, color = symbol)) +
  geom_point(shape = 17, size = 4) +
  scale_color_manual(values = selected_colors) + 
  labs(
    x = "Rank", y = NULL, color = NULL,
    title = "Rank in Fama-French variables for selected stocks from the Dow index"
  ) +
  coord_cartesian(xlim = c(1, 30))
fig_rank_ff
```

## Key Takeaways

- Financial statements provide standardized, legally required insights into a company’s financial position
- Ratios allow benchmarking & trend analysis across liquidity, leverage, efficiency & profitability dimensions
- `fmpapi` enables easy access to financial data for ratio calculations & peer comparisons

## Exercises

1. ...

